DROP IF EXISTS TABLE VOTOS;
DROP IF EXISTS TABLE OPCION;
DROP IF EXISTS TABLE VOTANTE;
DROP IF EXISTS TABLE VOTACION;
DROP IF EXISTS TABLE CENSOS;
DROP IF EXISTS TABLE COLEGIOELECTORAL;


CREATE TABLE COLEGIOELECTORAL(codColegioElectoral VARCHAR(255) not null,
circunscripcion VARCHAR(255) not null,
ciudad VARCHAR(255) not null,
comunidadAutonoma VARCHAR(255) not null,
PRIMARY KEY(codColegioElectoral));


CREATE TABLE CENSOS(id INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
nombre VARCHAR(255),
nif VARCHAR(255),
email VARCHAR(255), 
codColegioElectoral INTEGER, 
password VARCHAR(255),
PRIMARY KEY(nif));


CREATE TABLE VOTACION(id BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) not null,
diaInicio DATE not null,
diaFin DATE not null, 
tipoVotacion VARCHAR(255) not null,
PRIMARY KEY(id));

CREATE TABLE VOTANTE(nif VARCHAR(255) not null,
tipoVoto VARCHAR(255) not null, 
estado BOOLEAN not null,
idVotacion BIGINT not null,
PRIMARY KEY(nif),
FOREIGN KEY(idVotacion) REFERENCES VOTACION(id),
FOREIGN KEY(nif) REFERENCES CENSOS(nif));
	
CREATE TABLE OPCION(id BIGINT not null,
nombre VARCHAR(255),
idVotacion BIGINT not null,
PRIMARY KEY(id),
FOREIGN KEY(idVotacion) REFERENCES VOTACION(id));

CREATE TABLE VOTOS(id BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) not null,
tipoVoto VARCHAR(255) not null,
opcionEscogida BIGINT not null,
totalVotos INTEGER not null,
idVotacion BIGINT not null,
colegioElectoral VARCHAR(255) not null,
PRIMARY KEY(opcionEscogida, idVotacion, colegioElectoral, tipoVoto),
FOREIGN KEY(opcionEscogida) REFERENCES OPCION(id),
FOREIGN KEY(idVotacion) REFERENCES VOTACION(id),
FOREIGN KEY(colegioElectoral) REFERENCES COLEGIOELECTORAL(codColegioElectoral));

